{"version":3,"sources":["./src/app/pages/setting/location-setting/location-setting.module.ts","./src/app/pages/setting/location-setting/location-setting.page.ts","./src/app/pages/setting/location-setting/location-setting.page.html"],"names":[],"mappings":"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","file":"3-es2015.28261455a0b6e5ef8ea8.js","sourcesContent":["import {AgmCoreModule} from '@agm/core';\nimport {CommonModule} from '@angular/common';\nimport {NgModule} from '@angular/core';\nimport {FormsModule} from '@angular/forms';\nimport {RouterModule} from '@angular/router';\nimport {Routes} from '@angular/router';\nimport {ComponentsModule} from '@app/components/components.module';\nimport {LocationSettingPage} from '@app/pages/setting/location-setting/location-setting.page';\nimport {IonicModule} from '@ionic/angular';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: LocationSettingPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RouterModule.forChild(routes),\n    ComponentsModule,\n    AgmCoreModule,\n  ],\n  declarations: [LocationSettingPage]\n})\nexport class LocationSettingPageModule {\n}\n","import {NgZone} from '@angular/core';\nimport {Component} from '@angular/core';\nimport {OnInit} from '@angular/core';\nimport {Position} from '@models/business/position.model';\nimport {UserLocation} from '@models/settings/user-location.model';\nimport {UserLocationAdderPage} from '@app/pages/setting/user-location-adder/user-location-adder.page';\nimport {ModalController} from '@ionic/angular';\nimport {BackgroundGeolocationService} from '@services/background-geolocation/background-geolocation.service';\nimport {MobileContextService} from '@services/mobile-configuration-service/mobile-context.service';\nimport {Subject} from 'rxjs';\nimport {takeUntil} from 'rxjs/operators';\nimport {SettingsManager} from '@services/settings-providers/settings.service';\n\nconst defaultZoomLevel: number = 14;\n\n@Component({\n  selector: 'app-location-setting',\n  templateUrl: './location-setting.page.html',\n  styleUrls: ['./location-setting.page.scss'],\n})\nexport class LocationSettingPage implements OnInit {\n  private unsubscribe: Subject<void> = new Subject<void>();\n\n  center: Position;\n  marker: Position;\n  latitude = 54.526000;\n  longitude = -105.255100;\n  zoom = defaultZoomLevel;\n  name: string;\n  address: string;\n\n  userLocations: Array<UserLocation> = [];\n\n  constructor(\n    private mobileContextService: MobileContextService,\n    private backgroundGeolocationService: BackgroundGeolocationService,\n    private modalCtrl: ModalController,\n    private ngZone: NgZone,\n    private settingsManager: SettingsManager,\n  ) {\n  }\n\n  ionViewWillEnter(): void {\n    this.mobileContextService.userSettingsObservable\n      .pipe(\n        takeUntil(this.unsubscribe)\n      )\n      .subscribe(userSettings => {\n        if (userSettings) {\n          this.userLocations = userSettings.userLocations;\n        }\n      });\n  }\n\n  ngOnInit() {\n    this.setCurrentCenter();\n  }\n\n  ionViewDidLeave() {\n    this.unsubscribe.next();\n  }\n\n  ionViewWillUnload() {\n    this.unsubscribe.complete();\n  }\n\n  show(location: UserLocation) {\n    this.center = location.position;\n    this.marker = location.position;\n    this.zoom = defaultZoomLevel;\n  }\n\n  removeLocation(index: number) {\n    this.ngZone.run(() => {\n      this.userLocations.splice(index, 1);\n      this.settingsManager.locationChanged();\n    });\n  }\n\n  async addLocation() {\n    await this.modalCtrl.create({\n      component: UserLocationAdderPage,\n      componentProps: {}\n    })\n      .then(\n        res => {\n          res.present();\n          res.onDidDismiss().then(\n            (data) => {\n              if (data && data.data && data.data.location) {\n                this.userLocations.push(data.data.location);\n                this.settingsManager.locationChanged();\n              }\n            }\n          );\n        }\n      );\n  }\n\n  private setCurrentCenter() {\n    const position: Position = this.backgroundGeolocationService.getLastKnownPosition();\n    if (position) {\n      this.center = position;\n      this.zoom = defaultZoomLevel;\n    } else {\n      this.center = new Position(this.latitude, this.longitude);\n      this.zoom = 2;\n    }\n  }\n}\n","<ion-content class=\"ion-no-padding\">\n  <ion-grid>\n    <ion-row *ngFor=\"let location of userLocations; let i = index\" class=\"ion-text-wrap\">\n      <ion-col size=\"10\" (click)=\"show(location)\">\n        {{ location.name }}: {{ location.address }}\n      </ion-col>\n      <ion-col size=\"2\">\n        <ion-button size=\"small\" (click)=\"removeLocation(i)\">\n          <fa-icon [icon]=\"['fas','times']\"></fa-icon>\n        </ion-button>\n      </ion-col>\n    </ion-row>\n  </ion-grid>\n</ion-content>\n\n<ion-footer style=\"height: 340px;\" class=\"ion-text-center\">\n  <ion-button size=\"small\" (click)=\"addLocation()\"><span translate=\"location-settings.addLocation\"></span></ion-button>\n  <ng-container *ngIf=\"center\">\n    <agm-map [latitude]=\"center.latitude\" [longitude]=\"center.longitude\" [zoom]=\"zoom\">\n      <agm-marker [latitude]=\"marker.latitude\" [longitude]=\"marker.longitude\" *ngIf=\"marker\"></agm-marker>\n    </agm-map>\n  </ng-container>\n</ion-footer>\n"],"sourceRoot":"webpack:///"}